<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Intermediate Slurm: Monitoring a Jobs performance</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/wehi/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/wehi/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/wehi/favicon-16x16.png"><link rel="manifest" href="../favicons/wehi/site.webmanifest"><link rel="mask-icon" href="../favicons/wehi/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav wehi"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="wehi-logo" alt="wehi" src="../assets/images/wehi-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../02-cpumonitoring.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav wehi" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="wehi" src="../assets/images/wehi-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Intermediate Slurm
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Intermediate Slurm
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Intermediate Slurm
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 20%" class="percentage">
    20%
  </div>
  <div class="progress wehi">
    <div class="progress-bar wehi" role="progressbar" style="width: 20%" aria-valuenow="20" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../02-cpumonitoring.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        2. Monitoring a Jobs performance
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#calculating-pi">Calculating <span class="math inline">\(\pi\)</span></a></li>
<li><a href="#is-it-really-working-in-parallel">Is it really working in parallel?</a></li>
<li><a href="#getting-more-information-from-a-running-job">Getting more information from a running job</a></li>
<li><a href="#investigating-memory-usage-of-pi-cpu2">Investigating memory usage of <code>pi-cpu2</code></a></li>
<li><a href="#monitoring-gpu-activity">Monitoring GPU activity</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-jobarrays.html">3. Job Arrays</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-jobdependencies.html">4. Organising dependent Slurm jobs</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-rpython.html">5. R and Python Slurm scripts</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/01-introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/03-jobarrays.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/01-introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction
        </a>
        <a class="chapter-link float-end" href="../instructor/03-jobarrays.html" rel="next">
          Next: Job Arrays...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Monitoring a Jobs performance</h1>
        <p>Last updated on 2025-03-25 |

        <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/edit/main/episodes/02-cpumonitoring.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>Why should I learn to monitor performance of my Slurm jobs?</li>
<li>Which tools can I use to monitor my jobs’ activity?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand why jobs should be monitored carefully.</li>
<li>Show common tools to use to monitor jobs’ activity and
performance.</li>
<li>Demonstrate a general procedure to investigate why a job may not be
performing as expected.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="calculating-pi">Calculating <span class="math inline">\(\pi\)</span>
<a class="anchor" aria-label="anchor" href="#calculating-pi"></a></h2>
<hr class="half-width"><p>You’re an honours student and your project is looking at ways of
calculating <span class="math inline">\(\pi\)</span>. Your PI has
recommended using an existing piece of software he saw someone talk
about at a conference recently. A useful feature is that it works in
parallel, and is consequently quite fast! You try running the program on
your laptop, and it takes about 1.2 seconds for each calculation of
<span class="math inline">\(\pi\)</span>. This is a little slow, so you
try running it on Milton</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Before starting these programs, make sure to load the
<code>gcc</code> module (<code>module load gcc</code>).</p>
</div>
</div>
</div>
<div id="running-the-program" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="running-the-program" class="callout-inner">
<h3 class="callout-title">Running the Program</h3>
<div class="callout-content">
<p>In the example-programs.zip file, is the <code>pi-cpu</code>
executable. This is the program your supervisor has recommended.
<strong>Try running it with <code>srun</code> on Milton!</strong> Does
it perform each calculation of <span class="math inline">\(\pi\)</span>
in less time than 1.2s?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">srun</span> pi-cpu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11087600 queued and waiting for resources
srun: job 11087600 has been allocated resources
Result: 3.1414796637875 Error: -0.0001130772251 Time: 3.0970s
Result: 3.1417489401899 Error:  0.0001561991773 Time: 3.0912s
Result: 3.1415377569880 Error: -0.0000549840246 Time: 3.1001s
...</code></pre>
</div>
<p>Each calculation of <span class="math inline">\(\pi\)</span> takes
about 3 seconds - <em>slower</em> than your laptop! This is something to
remember about HPC: The main reason why HPC is “faster” is because it
has <em>many</em> CPU cores, but the cores working individually are
probably slower than your PC’s CPU cores. HPC’s usefulness comes from
hundreds or thousands of CPU cores working in parallel!</p>
</div>
</div>
</div>
</div>
<p>You tell your supervisor that HPC isn’t helping! But they assure you
that it should be really fast - the presenter at the conference
demonstrated times way less than 3 seconds!</p>
<p>Your job now is to figure out why <code>pi-cpu</code> isn’t
performing fast for you.</p>
</section><section><h2 class="section-heading" id="is-it-really-working-in-parallel">Is it really working in parallel?<a class="anchor" aria-label="anchor" href="#is-it-really-working-in-parallel"></a></h2>
<hr class="half-width"><p>So far, we’ve only <em>heard</em> that the software works by
performing computations in parallel with multiple CPUs. One way we can
verify this is with the <code>htop</code> tool.</p>
<div id="revisiting-seff" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="revisiting-seff" class="callout-inner">
<h3 class="callout-title">Revisiting <code>seff</code>
</h3>
<div class="callout-content">
<p><code>seff</code> is a lightweight utility to check the efficiency of
Slurm jobs. Try and check the efficiency of your job with
<code>seff</code>. Is it working in parallel?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Run <code>seff</code> with your Job ID. For example, with a job ID of
<code>11087600</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">seff</span> 11087600</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 11087600
Cluster: milton
User/Group: yang.e/allstaff
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 2
CPU Utilized: 00:00:14
CPU Efficiency: 50.00% of 00:00:28 core-walltime
Job Wall-clock time: 00:00:14
Memory Utilized: 0.00 MB (estimated maximum)
Memory Efficiency: 0.00% of 20.00 MB (10.00 MB/core)</code></pre>
</div>
<p>You should see that the job has requested 2 CPUs by default, and has
an efficiency of roughly 50%. Definitely not parallel!</p>
<p>You might’ve also noticed that there’s no memory utilization
information. We’ll discuss this later.</p>
</div>
</div>
</div>
</div>
<p>From <code>seff</code>, it looks like <code>pi-cpu</code> isn’t
working in parallel. But perhaps you haven’t requested enough resources
from Slurm? Let’s try double the number of CPUs requested to 4:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">srun</span> <span class="at">-c</span> 4 pi-cpu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 16555628 queued and waiting for resources
srun: job 16555628 has been allocated resources
Result: 3.1413745257865 Error: -0.0002182152261 Time: 3.1130s
Result: 3.1416269865888 Error:  0.0000342455762 Time: 3.1173s
Result: 3.1413426117862 Error: -0.0002501292264 Time: 3.1159s
Result: 3.1416289953888 Error:  0.0000362543763 Time: 3.1151s
Result: 3.1414934337876 Error: -0.0000993072250 Time: 3.1139s</code></pre>
</div>
<p>Not much change in time to calculate pi. Using <code>seff</code> to
check the CPU utilisation:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">seff</span> 16555633</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 16555633
Cluster: milton
User/Group: yang.e/allstaff
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 4
CPU Utilized: 00:00:16
CPU Efficiency: 25.00% of 00:01:04 core-walltime
Job Wall-clock time: 00:00:16
Memory Utilized: 0.00 MB (estimated maximum)
Memory Efficiency: 0.00% of 40.00 MB (10.00 MB/core)</code></pre>
</div>
<p>and our efficiency has decreased proportionally with the number of
CPUs we’ve requested.</p>
<div id="getting-help" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="getting-help" class="callout-inner">
<h3 class="callout-title">Getting help</h3>
<div class="callout-content">
<p>Most commands that <em>can</em> run in parallel, don’t do so by
default. See if you can figure out how to get the command to utilize
multiple CPU cores from the <code>pi-cpu</code> help.</p>
<p>Hint: use <code>./pi-cpu -h</code></p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">./pi-cpu</span> <span class="at">-h</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Usage:
    pi-cpu [options]

Options:
    --parallel &lt;N&gt;, -p &lt;N&gt;    Number of threads to use (default: 1)
    --trials &lt;N&gt;, -n &lt;N&gt;      Number of trials to calculate pi (default: 123,456,789)
    --reps &lt;N&gt;, -r &lt;N&gt;        Number of times to calculate pi (default: 5)
where &lt;N&gt; is an integer.</code></pre>
</div>
<p>It looks like we need to use the <code>--parallel</code> or
<code>-p</code> option! Let’s try this with our previous command:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">srun</span> <span class="at">-c</span> 4 pi-cpu <span class="at">-p</span> 4</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 16555642 queued and waiting for resources
srun: job 16555642 has been allocated resources
Result: 3.1417442421899 Error:  0.0001515011773 Time: 1.0078s
Result: 3.1415662365883 Error: -0.0000265044243 Time: 1.0076s
Result: 3.1415902773885 Error: -0.0000024636241 Time: 1.0070s
Result: 3.1415876205884 Error: -0.0000051204241 Time: 1.0122s
Result: 3.1414994277876 Error: -0.0000933132249 Time: 1.2378s</code></pre>
</div>
<p>The run times have decreased significantly! And checking the
efficiency with <code>seff</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">seff</span> 16555642</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 16555642
Cluster: milton
User/Group: yang.e/allstaff
State: COMPLETED (exit code 0)
Nodes: 1
Cores per node: 4
CPU Utilized: 00:00:20
CPU Efficiency: 83.33% of 00:00:24 core-walltime
Job Wall-clock time: 00:00:06
Memory Utilized: 0.00 MB (estimated maximum)
Memory Efficiency: 0.00% of 40.00 MB (10.00 MB/core)</code></pre>
</div>
<p>Shows that CPU efficiency is now &gt;80%! Turns out we needed to read
the instructions carefully first!</p>
<p>Many programs behave like this: they will have parallel capability
built in, but will need to be switched on perhaps with a flag/option
like with <code>pi-cpu</code>. Sometimes it can also be switched on via
an environment variable.</p>
<p>Parallel programs are generally designed to run in this way so that
the parallel program doesn’t unintentionally use up all the resources on
the machine you’re running on.</p>
</div>
</div>
</div>
</div>
<div id="seeing-the-effects-of-hyperthreading" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="seeing-the-effects-of-hyperthreading" class="callout-inner">
<h3 class="callout-title">Seeing the effects of Hyperthreading</h3>
<div class="callout-content">
<p>Before, we tried requesting more CPUs from Slurm, but that didn’t
change much about how the program itself ran. But now that we’re using 4
CPUs with <code>pi-cpu</code> and also requesting 4 CPUs from Slurm. But
what happens if we double this request from Slurm again (without
increasing the number passed to <code>-p</code>)?</p>
<p>Try doing that by requesting 8 CPUs from Slurm. After, try doubling
it again and requesting 16 CPUs.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">srun</span> <span class="at">-c</span> 8 pi-cpu <span class="at">-p</span> 4</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 16555656 queued and waiting for resources
srun: job 16555656 has been allocated resources
Result: 3.1417761237902 Error:  0.0001833827776 Time: 0.6896s
Result: 3.1416477873890 Error:  0.0000550463764 Time: 0.6908s
Result: 3.1416972621894 Error:  0.0001045211769 Time: 0.6859s
Result: 3.1413705729865 Error: -0.0002221680261 Time: 0.6859s
Result: 3.1418576745909 Error:  0.0002649335783 Time: 0.6858s</code></pre>
</div>
<p>Oh, the time almost halved! If you check the efficiency of
<code>seff</code>, you should see that the efficiency if roughly 50%. If
we try double the CPUs requested to 16:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">srun</span> <span class="at">-c</span> 16 pi-cpu <span class="at">-p</span> 4</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 16555928 queued and waiting for resources
srun: job 16555928 has been allocated resources
Result: 3.1414441209871 Error: -0.0001486200254 Time: 0.6897s
Result: 3.1415679861883 Error: -0.0000247548243 Time: 0.6862s
Result: 3.1418510649908 Error:  0.0002583239783 Time: 0.6854s
Result: 3.1416825849893 Error:  0.0000898439767 Time: 0.6852s
Result: 3.1415102493877 Error: -0.0000824916248 Time: 0.6853s</code></pre>
</div>
<p>But this time, the time has stayed the same. So why does
<code>pi-cpu -p 4</code> benefit from requesting 8 CPUs from Slurm?</p>
<p>This is because Milton’s Slurm is configured such that when you
request 1 CPU, you’re actually getting a hyperthread. For every two
hyperthreads, you get one physical CPU core.</p>
<p>So, when you execute <code>srun -c 4 pi-cpu -p 4</code>,
<code>pi-cpu -p 4</code> is actually executed on a two physical cores.
But thanks to hyperthreading, you manage to get some speedup almost for
free! When you execute <code>srun -c 8 pi-cpu 4</code>,
<code>pi-cpu</code> is now running on two separate physical cores, hence
we see a speedup!</p>
<p>This is important to remember because if you forget about how Slurm
CPUs are equivalent to hyperthreads, rather than physical CPU cores,
programs that run in parallel might appear less efficient (like in the
case of <code>pi-cpu</code>!).</p>
<p>NOTE: this configuration is unique to Milton. Most other HPC
facilities equate Slurm CPUs to physical CPU cores, not
hyperthreads.</p>
</div>
</div>
</div>
</div>
<div id="discussion5" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>What might happen as we add more CPUs? Most parallel programs
eventually reach a point where trying to use more CPUs doesn’t actually
decrease the run time of the program in a linear manner. It may be
useful to experiment on your program and/or input data to see when it
stops being worth it to add CPUs (AKA performing a “scaling study”)</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="getting-more-information-from-a-running-job">Getting more information from a running job<a class="anchor" aria-label="anchor" href="#getting-more-information-from-a-running-job"></a></h2>
<hr class="half-width"><p>We’ve used <code>seff</code> so far to get resource utilisation of a
job. However, this only works for a complete job, not for a running job.
Instead, Slurm offers the <code>sstat</code> tool to obtain information
about a running job. This way, we can check on the utilisation while the
job is running.</p>
<p>let’s start a long-running job with our <code>pi-cpu</code>
program:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--wrap</span> ./pi-cpu <span class="at">-r</span> <span class="at">-1</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 16559207</code></pre>
</div>
<p>Check that the job is running with <code>squeue</code>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">--me</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
          16559207   regular     wrap   yang.e  R       0:01      1 il-n11</code></pre>
</div>
<div id="sbatch---wrap" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="sbatch---wrap" class="callout-inner">
<h3 class="callout-title"><code>sbatch --wrap</code></h3>
<div class="callout-content">
<p>the <code>--wrap</code> option lets us pass a singular command to
<code>sbatch</code> without having to write an entire script! This is
useful for debugging and when you run <code>sbatch</code> inside
scripts.</p>
</div>
</div>
</div>
<p>Running <code>sstat</code> with a job ID on it’s own doesn’t work,
you need to remember to pass the <code>-a</code> flag:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">sstat</span> <span class="at">-a</span> 16559207</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JobID         MaxVMSize  MaxVMSizeNode  MaxVMSizeTask  ...
------------ ---------- -------------- --------------  ...
16559207.ex+    108056K         il-n11              0  ...
16559207.ba+    136648K         il-n11              0  ...</code></pre>
</div>
<p>There’s a lot of output! By default, <code>sstat</code> will dump
everything it can about the job onto your terminal. To control what
output gets shown, you can use the <code>-o</code> option and supply
some fields. Below is a recommended command you can use in the
future:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">sstat</span> <span class="at">-ao</span> jobid%15,nodelist,avecpu,maxrss,maxdiskwrite,maxdiskread <span class="op">&lt;</span>jobid<span class="op">&gt;</span></span></code></pre>
</div>
<p>And below is an example output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          JobID             Nodelist     AveCPU     MaxRSS MaxDiskWrite  MaxDiskRead
--------------- -------------------- ---------- ---------- ------------ ------------
16559207.extern               il-n11   00:00:00        98K        1.00M         2012
 16559207.batch               il-n11   00:07:53       818K         8309        17747</code></pre>
</div>
<p>Which is much more comprehendable!</p>
<div id="discussion7" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>the arguments to pass to <code>sstat -ao</code> have been supplied
here for convenience. But, you can create your own! Use the
<code>sstat --helpformat</code> command to see which available fields
there are. You’ll also want to check the <code>man</code> page for
<code>sstat</code> to find out exactly what these fields mean.</p>
<p>What do the fields in the previous <code>sstat</code> command mean?
reminder: the command is
<code>sstat -ao jobid%15,nodelist,avecpu,maxrss,maxdiskwrite,maxdiskread &lt;jobid&gt;</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>From the <code>Job Status Fields</code> section in the man page, we
can see that:</p>
<ul><li>
<strong>AveCPU</strong> Average (system + user) CPU time of all
tasks in job.</li>
<li>
<strong>AveDiskRead</strong> Average number of bytes read by all
tasks in job.</li>
<li>
<strong>AveDiskWrite</strong> Average number of bytes written by all
tasks in job.</li>
<li>
<strong>JobID</strong> The number of the job or job step. It is in
the form: job.jobstep</li>
<li>
<strong>MaxDiskRead</strong> Maximum number of bytes read by all
tasks in job.</li>
<li>
<strong>MaxDiskWrite</strong> Maximum number of bytes written by all
tasks in job.</li>
<li>
<strong>MaxRSS</strong> Maximum resident set size of all tasks in
job.</li>
</ul><p>Nodelist is left out, but hopefully that’s self-explanatory.</p>
</div>
</div>
</div>
</div>
<p>To summarize, the Slurm utilities you can use to monitor your jobs
are:</p>
<ul><li>
<code>squeue</code> is good for getting the <em>status</em> of
running or pending jobs, but don’t offer much in terms of utilization
information.</li>
<li>
<code>sacct</code>, with output formatting can be used to view
resource utilsation of jobs that have ended.
<ul><li>
<code>seff</code> serves a similar purpose to <code>sacct</code>,
but with the output presented in a more easily understood manner.</li>
</ul></li>
<li>
<code>sstat</code> can be used to query resource utilisation of a
<em>running</em> job. But also requires some output formatting.</li>
</ul></section><section><h2 class="section-heading" id="investigating-memory-usage-of-pi-cpu2">Investigating memory usage of <code>pi-cpu2</code>
<a class="anchor" aria-label="anchor" href="#investigating-memory-usage-of-pi-cpu2"></a></h2>
<hr class="half-width"><p>In the example programs, there should be the <code>pi-cpu2</code>
executable. Lets see what happens when we run it:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">srun</span> pi-cpu2</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>srun: job 12064697 queued and waiting for resources
srun: job 12064697 has been allocated resources
slurmstepd: error: Detected 1 oom_kill event in StepId=12064697.0. Some of the step tasks have been OOM Killed.
srun: error: il-n01: task 0: Out Of Memory</code></pre>
</div>
<p>Ok, that wasn’t what we expected! The error message says that our job
was <code>OOM Killed</code> and that <code>task 0: Out Of Memory</code>.
Here, <code>OOM</code> is an abbreviation for Out Of Memory. The overall
error message is indicating that your job exceeded the memory allocation
of your job, which caused Slurm to cancel it. If we use
<code>seff</code> on that job:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">seff</span> 12064697</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 12064697
Cluster: milton
User/Group: yang.e/allstaff
State: OUT_OF_MEMORY (exit code 0)
Nodes: 1
Cores per node: 2
CPU Utilized: 00:00:00
CPU Efficiency: 0.00% of 00:00:00 core-walltime
Job Wall-clock time: 00:00:00
Memory Utilized: 0.00 MB (estimated maximum)
Memory Efficiency: 0.00% of 20.00 MB (10.00 MB/core)</code></pre>
</div>
<p>You will find that it produces only the requested resources and the
<code>OUT_OF_MEMORY</code> state and no utilization information is
found. Similarly, if we execute <code>sacct</code>, we should see
<code>OUT_OF_ME+</code> and <code>0:125</code> under the
<code>STATE</code> and <code>ExitCode</code> columns, respectively:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">sacct</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>JobID           JobName  Partition    Account  AllocCPUS      State ExitCode
------------ ---------- ---------- ---------- ---------- ---------- --------
... skipped output...
12064697        pi-cpu2    regular       wehi          2 OUT_OF_ME+    0:125
12064697.ex+     extern                  wehi          2 OUT_OF_ME+    0:125
12064697.0      pi-cpu2                  wehi          2 OUT_OF_ME+    0:125</code></pre>
</div>
<div id="discussion8" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>This job failed because it started and then ran out of memory almost
immediately. Some jobs may only request large amounts of memory after
the program has been running awhile. In those cases, <code>seff</code>
and <code>sacct</code> may still produce meaningful output.</p>
</div>
</div>
</div>
<p>The Slurm utilities can already tell you a lot of information that
you’ll find useful when evaluating your Slurm jobs. However, there are
some important limitations preventing these tools from being
“all-purpose”.</p>
<ul><li>The information used by <code>seff</code> and <code>sacct</code> are
collected every 30 seconds only, and information isn’t collected about
jobs that fail for any reason.
<ul><li>this makes it difficult to diagnose jobs that use too much
memory.</li>
<li>it also makes it difficult to identify sudden and short-lived spikes
in resource usage.</li>
<li>This is why for our short <code>pi-cpu</code> job, <code>seff</code>
doesn’t show any memory usage!</li>
</ul></li>
<li>
<code>sstat</code> is limited in how frequently it can be used
<ul><li>if used too often, your <code>sstat</code> calls will be
throttled.</li>
<li>this a system configuration to prevent Slurm from being
overloaded.</li>
</ul></li>
</ul><p>Because of this, in some cases, it’s recommended to use system tools
that don’t rely on Slurm’s infrastructure.</p>
<div class="section level3">
<h3 id="introducing-htop">Introducing <code>htop</code>
<a class="anchor" aria-label="anchor" href="#introducing-htop"></a></h3>
<p><code>htop</code> is an interactive “process” viewer that lets you
monitor processes across the entire node. It’s very similar to Task
Manager on Windows or Activity Monitor on Macs, but it works from the
command line!</p>
</div>
<div class="section level3">
<h3 id="interpreting-htops-output">Interpreting <code>htop</code>’s output<a class="anchor" aria-label="anchor" href="#interpreting-htops-output"></a></h3>
<p>Try running <code>htop</code> on the login node. You should get
something similar to below:</p>
<figure><img src="../fig/htop-screenshot.png" alt="Screenshot of htop output" class="figure mx-auto d-block"><div class="figcaption">Screenshot of <code>htop</code> output</div>
</figure><p><code>htop</code> gives a lot of information, so here is a quick
explainer on what is being shown.</p>
<p>At the top of the <code>htop</code> output, you’ll see multiple bars
and each bar tells you the activity level of a single CPU core. If a bar
is at 100%, then that means that that CPU core is completely busy.</p>
<figure><img src="../fig/htop-screenshot-cpubars.png" alt="CPU utilization bars from htop" class="figure mx-auto d-block"><div class="figcaption">CPU utilization bars from
<code>htop</code>
</div>
</figure><p>Below the bar, on the left side, is another bar which tells you how
much of the node’s memory is occupied. Next to the bar is information
about how much load the node is under.</p>
<figure><img src="../fig/htop-screenshot-memload.png" alt="Memory utilization bars and load from htop" class="figure mx-auto d-block"><div class="figcaption">Memory utilization bars and load from
<code>htop</code>
</div>
</figure><p>Everything below that is most important to monitoring your jobs. That
table is a dynamic list of “processes” running on the node. And each
column tells you a bit of different information about the process.</p>
<figure><img src="../fig/htop-screenshot-procs.png" alt="Process list and fields from htop" class="figure mx-auto d-block"><div class="figcaption">Process list and fields from
<code>htop</code>
</div>
</figure><ol style="list-style-type: decimal"><li>
<code>RES</code> tells you the “resident” memory of the process,
i.e., the memory (in bytes) being used by the process.</li>
<li>
<code>CPU%</code> is the percentage of a CPU core the process is
using.</li>
<li>
<code>Command</code> is telling you the command the process is
running. This can be used to help you figure out which processes are
related to your job.</li>
</ol><p>By default, <code>htop</code> will show you <em>everyone’s</em>
processes, which is not relevant to us. To get only your processes, quit
<code>htop</code> by pressing <code>q</code>, and run it again with</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">htop</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<p>You should see a list of processes that belong to you only!</p>
</div>
<div class="section level3">
<h3 id="monitoring-pi-cpu-with-htop">Monitoring <code>pi-cpu</code> with <code>htop</code>
<a class="anchor" aria-label="anchor" href="#monitoring-pi-cpu-with-htop"></a></h3>
<p>This time, we’re going to submit the <code>pi-cpu</code> command as a
job with <code>sbatch</code>. We’re also going to add the
<code>-r -1</code> flag and value, so that the program will run
indefinitely. We can do so by</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--wrap</span><span class="op">=</span><span class="st">"srun ./pi-cpu -r -1"</span></span></code></pre>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>You might get questions as to why <code>srun</code> should be used.
In many cases it’s not important, but <code>srun</code> helps Slurm
collect CPU efficiency, memory usage, and IO data about the command it’s
being used to run. Which is important for this purpose!</p>
<p>The most beneficial aspect of using <code>srun</code> inside
<code>sbatch</code> is that if the job fails or is cancelled, the CPU
efficiency, memory usage, and IO data is saved, which makes
<code>seff</code> and <code>sacct</code> still useful. If
<code>srun</code> is not used, performance data from <code>seff</code>
and <code>sacct</code> are discarded if the job ends prematurely.</p>
</div>
</div>
</div>
</div>
<p>Once you’ve confirmed the job has started with <code>squeue</code>,
and determined which node it’s running on, <code>ssh</code> to that node
and run <code>htop -u $USER</code>.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--wrap</span><span class="op">=</span><span class="st">"srun ./pi-cpu -r -1"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 11088927</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
  11088927   regular     wrap   yang.e  R       0:12      1 sml-n15</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">ssh</span> sml-n15</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>yang.e@sml-n15s password: # enter your password
Last login: Fri Apr 14 14:40:38 2023 from slurm-login.hpc.wehi.edu.au</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="ex">htop</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<figure><img src="../fig/htop-picpu-1.png" alt="processes associated with pi-cpu" class="figure mx-auto d-block"><div class="figcaption">processes associated with
<code>pi-cpu</code>
</div>
</figure><p>From the <code>Command</code> column, you can find the relevant data
for your job.</p>
<p>Hint: You can click on <code>CPU%</code> to sort processes by their
CPU usage.</p>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>You may wish to explain how to distinguish processes of interest from
system processes. Usually, the process of interest will be identifiable
by the command that is being run.</p>
</div>
</div>
</div>
</div>
<p>If we look at the <code>CPU%</code> column, we can see that the
<code>pi-cpu</code> process is using 100%! That might sound good, but
the percentage is the percentage of a CPU <em>core</em> being used,
i.e., 100% means that 100% of a single CPU core is being used, or 200%
means 100% of two CPU core are being used. So, the <code>pi-cpu</code>
process is only using 1 CPU core i.e., not parallel! This is not what
your PI promised!</p>
<p>But maybe it’s because we didn’t request more CPUs? We didn’t ask for
any specific number of CPUs in our command after all. Let’s try request
4 CPUs instead. But first, let’s cancel the already running job.</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="ex">scancel</span> 11088927</span></code></pre>
</div>
<p>And then we can try again, but with more CPUs:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">-c</span> 4 <span class="at">--wrap</span><span class="op">=</span><span class="st">"srun ./pi-cpu -p 4 -r -1"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 11089020</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
11089020   regular     wrap   yang.e  R       0:12      1 sml-n15</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="fu">ssh</span> sml-n15</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>yang.e@sml-n15s password: # enter your password
Last login: Fri Apr 14 14:40:38 2023 from slurm-login.hpc.wehi.edu.au</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="ex">htop</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<figure><img src="../fig/htop-picpu-2.png" alt="processes associated with pi-cpu after requesting more CPUs from Slurm" class="figure mx-auto d-block"><div class="figcaption">processes associated with <code>pi-cpu</code>
after requesting more CPUs from Slurm</div>
</figure><p>We can see that there is a process using around 300%-400% of CPU
which should have <code>pi-cpu</code> in the command column.</p>
<div id="discussion9" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p><code>htop</code> is a Terminal User Interface (TUI) and allows you
to click on the interface to interact with it! What happens when you
click on <code>CPU%</code> and <code>MEM%</code>? What if you click on
the <code>Tree</code> button on The bottom?</p>
<p>After this, see if you can add disk read/write information columns to
the <code>htop</code> interface.</p>
<p>Hint: You’ll need to click on <code>Setup</code> in the bottom-left
corner and you may need to use your arrow keys!</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>Clicking on <code>CPU%</code> and <code>MEM%</code> will order the
processes by how much of those resoures are being used. Subsequent
clicks will reverse the order.</p>
<p>Clicking on <code>Tree</code> will group the processes by
sub-processes, so you can see which processes were spawned by which.</p>
<p>To add disk read/write columns, you can click on
<code>Setup -&gt; Columns -&gt; press right twice to get the cursor to "Available Columns" -&gt; scroll down with your arrow keys and press enter on</code>IO_READ_WRITE<code>and</code>IO_WRITE_RATE`</p>
</div>
</div>
</div>
</div>
<p>Now, this job runs forever, so we should cancel it and move on.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="ex">scancel</span> 11089020</span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="monitoring-gpu-activity">Monitoring GPU activity<a class="anchor" aria-label="anchor" href="#monitoring-gpu-activity"></a></h2>
<hr class="half-width"><p>You’re consumed by the need-for-speed, and you’re ready to try the
<code>pi-gpu</code> program published by the same authors! When running
the program, you will need:</p>
<ul><li>1GB memory</li>
<li>1 GPU (of any kind)</li>
<li>the <code>CUDA/11.8</code> module is loaded</li>
</ul><div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="ex">module</span> load CUDA/11.8</span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--gres</span><span class="op">=</span>gpu:1 <span class="at">--mem</span><span class="op">=</span>1G <span class="at">--partition</span><span class="op">=</span>gpuq pi-gpu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 12066158 queued and waiting for resources
srun: job 12066158 has been allocated resources
Result: 3.1415535681881 Error: -0.0000390854017 Time: 0.2894s
Result: 3.1416463617890 Error:  0.0000537081992 Time: 0.2065s
Result: 3.1415584281882 Error: -0.0000342254016 Time: 0.2060s
...</code></pre>
</div>
<p>The job ran and it it’s about <code>3.0/0.2 = 15</code> times faster
than <code>pi-cpu2</code>! You find out from the <code>--help</code>
option, that <code>pi-gpu</code> also has a <code>-p</code> option which
can help you with running the program on more GPUs on the same node. Try
it out with <code>-p 2</code> and see if you get a 2x speedup.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--gres</span><span class="op">=</span>gpu:2 <span class="at">--mem</span><span class="op">=</span>1G <span class="at">--partition</span><span class="op">=</span>gpuq pi-gpu <span class="at">-p</span> 2</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 12066179 queued and waiting for resources
srun: job 12066179 has been allocated resources
Result: 3.1415107353877 Error: -0.0000819182020 Time: 0.4006s
Result: 3.1417724625901 Error:  0.0001798090003 Time: 0.1990s
Result: 3.1413390477862 Error: -0.0002536058036 Time: 0.1988s
...</code></pre>
</div>
<p>The speedup seems to be minimal!</p>
<div class="section level3">
<h3 id="introducing-nvtop">Introducing <code>nvtop</code>
<a class="anchor" aria-label="anchor" href="#introducing-nvtop"></a></h3>
<p>Let’s investigate the program’s behavior on the GPUs. We’ll do this
with <code>sbatch --wrap</code>:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--partition</span><span class="op">=</span>gpuq <span class="at">--gres</span><span class="op">=</span>gpu:2 <span class="at">--mem</span><span class="op">=</span>1G <span class="at">--wrap</span> <span class="st">"./pi-gpu -p 2 -r -1"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 12066180</code></pre>
</div>
<p>Now, ssh to the node you’ve been allocated and execute the
<code>nvtop</code> command:</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">ssh</span> gpu-p100-n02</span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a><span class="ex">module</span> load nvtop</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a><span class="ex">nvtop</span></span></code></pre>
</div>
<p>A terminal user interface should open that looks similar to:</p>
<p><img src="../fig/nvtop-screenshot-empty.png" alt="screenshot of nvtop output" class="figure"> Your output may differ if other
people’s jobs are running on the same node. The interface will be
reminiscent of <code>htop</code> but with differences:</p>
<ul><li>The top section doesn’t show the CPU utilization bars. Instead, they
show information about the device (we won’t be covering this
section).</li>
<li>The middle section shows a time-series chart of each GPU’s compute
(cyan) and memory (olive) utilization percentage over time.</li>
<li>The bottom section shows process information in a format similar to
<code>htop</code>:
<ul><li>
<code>PID</code>: process ID, which will correspond to a process on
<code>htop</code>
</li>
<li>
<code>USER</code>: The user the process is owned by</li>
<li>
<code>DEV</code>: the GPU ID the process is running on</li>
<li>
<code>GPU</code>: the “compute” utilization of the GPU (in
percentage)</li>
<li>
<code>GPU MEM</code>: the memory utilization of the GPU (in MB)</li>
<li>
<code>CPU</code>: the CPU utilization of the process</li>
<li>
<code>HOST MEM</code>: the CPU memory utilization of the
process</li>
<li>
<code>Command</code>: the command that the GPU is running</li>
</ul></li>
</ul><p><code>nvtop</code> is a useful tool in evaluating utilization of the
GPU while your job is running. This tool can be used as a way to check
that</p>
<ol style="list-style-type: lower-alpha"><li>the GPUs you requested are actually being used, and</li>
<li>that they are being fully utilized</li>
</ol><figure><img src="../fig/nvtop-screenshot-m1.png" alt="nvtop interface with pi-gpu -p 2 -r -1 running" class="figure mx-auto d-block"><div class="figcaption">
<code>nvtop</code> interface with
<code>pi-gpu -p 2 -r -1</code> running</div>
</figure><p>Two processes should show up in the process list with your
<code>pi-gpu</code> command. You will also see that utilization charts
move.</p>
<p>In the process list, you will see two entries corresponding to the
two GPUs that <code>pi-gpu</code> is using. Under <code>DEV</code> you
will see the device IDs which <code>pi-gpu</code> is using. In the
example screenshot above, they are GPU 0 and GPU 1. But,
<code>nvtop</code> shows the information for all the GPUs on the node by
default.</p>
</div>
<div class="section level3">
<h3 id="interpreting-nvtop-output">Interpreting <code>nvtop</code> output<a class="anchor" aria-label="anchor" href="#interpreting-nvtop-output"></a></h3>
<p>A good place to start when determining if your program is using the
GPU well is looking at the utilization. Many programs have parameters
which can affect this utilization - especially programs that process
data.</p>
<p>Many programs process data on the GPU in chunks as the GPU memory is
typically too small to handle the entire data set at once. These are
often controlled through chunk size or number of chunks parameters (you
might also see the word “block” being used instead). Typically, you want
to tune the parameters such that utilization is high.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Remember to cancel your jobs before moving on!
<code>scancel --me</code> will cancel all jobs created during this
lesson.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Requesting more resources from Slurm doesn’t mean your job knows how
to use them!
<ul><li>Many programs don’t work in parallel by default - either that
functionality doesn’t exist, or needs to be turned on!</li>
<li>More CPUs doesn’t always mean an equivalent speedup!</li>
</ul></li>
<li>Slurm offers multiple utilities to monitor your jobs. Each serving a
slightly different purpose
<ul><li>
<code>squeue</code> is for running/pending jobs and only provides
status/request information</li>
<li>
<code>sacct</code> and <code>seff</code> is best for complete jobs
and provides resource utilisation where available</li>
<li>
<code>sstat</code> is for running jobs and provides a snapshot of
resource utilisation</li>
</ul></li>
<li>The <code>htop</code> system tool is a great way to get live
information about how effective your job is
<ul><li>is more robust and provides more details than Slurm monitoring
tools</li>
</ul></li>
<li>
<code>nvtop</code> offers something similar to <code>htop</code>,
but for GPU processes.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/01-introduction.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/03-jobarrays.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/01-introduction.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Introduction
        </a>
        <a class="chapter-link float-end" href="../instructor/03-jobarrays.html" rel="next">
          Next: Job Arrays...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/edit/main/episodes/02-cpumonitoring.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/" class="external-link">Source</a></p>
				<p><a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:research.computing@wehi.edu.au">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/melbournebioinformatics/uom-varnish/tree/main" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://WEHI-ResearchComputing.github.io/intermediate-slurm/instructor/02-cpumonitoring.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "Slurm, HPC",
  "name": "Monitoring a Jobs performance",
  "creativeWorkStatus": "active",
  "url": "https://WEHI-ResearchComputing.github.io/intermediate-slurm/instructor/02-cpumonitoring.html",
  "identifier": "https://WEHI-ResearchComputing.github.io/intermediate-slurm/instructor/02-cpumonitoring.html",
  "dateCreated": "2023-04-13",
  "dateModified": "2025-03-25",
  "datePublished": "2025-04-01"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

