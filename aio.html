<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Intermediate Slurm: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="icon" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="text-decoration: unset">
           
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #383838">Pre-Alpha
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="color: #FF4955; border-radius: 5px"></i>
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Intermediate Slurm
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Intermediate Slurm
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Intermediate Slurm
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-cpumonitoring.html">2. Monitoring a Jobs performance</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="04-jobarrays.html">3. Job Arrays</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-introduction"><p>Content from <a href="01-introduction.html">Introduction</a></p>
<hr>
<p> Last updated on 2023-05-12 | 
        
        <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/edit/main/episodes/01-introduction.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why should I learn to monitor performance of my Slurm jobs?</li>
<li>What other features of Slurm can I use to help with my
workflows?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand why jobs should be monitored carefully.</li>
<li>Understand how Slurm’s additional features can alleviate pain
points.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="a-common-story"><h2 class="section-heading">A Common Story<a class="anchor" aria-label="anchor" href="#a-common-story"></a>
</h2>
<hr class="half-width">
<p>Imagine you’re a researcher who has spent a good chunk of their time
in research in the lab, or you’re a researcher who <em>does</em> do a
fair amount of computational research, but you’ve only been using laptop
so far. And one day, you join a new project that suddenly has a HUGE
amount of data to process - an amount that would take your laptop
<em>years</em> to get through!</p>
<p>Your PI has suggested that you give WEHI’s Milton HPC facility a go.
Milton has thousands of CPU cores, petabytes of storage, and terrabytes
of RAM to use! That would make processing this huge dataset a
breeze!</p>
<p>Since that suggestion, you’ve attended some introductory courses and
maybe you’ve found other researchers who know a bit about using Milton,
and you’ve managed to get started with using the Slurm scheduler and
submitting jobs.</p>
<p>But up until now, you’ve just been doing things in ways that
<em>works</em>, but you might be wondering whether yours jobs are setup
to run optimally. Maybe you’ve received emails from grumpy sysadmins
about inappropriately using resources. Or maybe you want to know how to
make it easier to more easily submit many similar jobs or jobs that
depend on each other.</p>
<div id="how-would-you-do-it" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="how-would-you-do-it" class="callout-inner">
<h3 class="callout-title">How would you do it?<a class="anchor" aria-label="anchor" href="#how-would-you-do-it"></a>
</h3>
<div class="callout-content">
<p>Let’s imagine you have hundreds of files that you need to run the
same command on. You know that Slurm can process that all in parallel,
so how would you go about submitting those jobs at first?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>If you’re new to Linux, you might’ve thought about submitting these
jobs manually! If you’ve done a bit of scripting, you might’ve thought
to use script arguments and a for loop to submit all the jobs. This
<em>works</em>, but Slurm also has <strong>job arrays</strong>! As we’ll
see in a later episode, job arrays are a Slurm feature that can help you
submit many similar jobs in one go!</p>
</div>
</div>
</div>
</div>
<div id="how-would-you-do-it-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="how-would-you-do-it-1" class="callout-inner">
<h3 class="callout-title">How would you do it?<a class="anchor" aria-label="anchor" href="#how-would-you-do-it-1"></a>
</h3>
<div class="callout-content">
<p>What about workflows that happen in steps and where these steps have
different resource requirements? Like for example, one step is
multi-threaded, so the job should request many CPUs; but the next step
is single-threaded only?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>If the second step is short, you might put the two steps into a
single Slurm job. But what if the second step takes a large amount of
time? Putting these two steps in the same job, could unfairly occupy
resources others could use!</p>
<p>You might also do this manually i.e., wait for the first step to
finish, and then submit the second job afterward.</p>
<p>Slurm also has job dependency features that you can take advantage of
to help with pipelines. We’ll cover this in a future episode!</p>
</div>
</div>
</div>
</div>

<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Slurm, together with Linux system tools, can help you ensure jobs
are utilizing resources effectively.</li>
<li>Slurm job arrays is a neater solution to submitting many similar
jobs.</li>
<li>Slurm job dependencies can help you organise pipelines.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-02-cpumonitoring"><p>Content from <a href="02-cpumonitoring.html">Monitoring a Jobs performance</a></p>
<hr>
<p> Last updated on 2023-05-12 | 
        
        <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/edit/main/episodes/02-cpumonitoring.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why should I learn to monitor performance of my Slurm jobs?</li>
<li>Which tools can I use to monitor my jobs’ activity?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand why jobs should be monitored carefully.</li>
<li>Show common tools to use to monitor jobs’ activity and
performance.</li>
<li>Demonstrate a general procedure to investigate why a job may not be
performing as expected.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="calculating-pi"><h2 class="section-heading">Calculating <span class="math inline">\(\pi\)</span><a class="anchor" aria-label="anchor" href="#calculating-pi"></a>
</h2>
<hr class="half-width">
<p>You’re an honours student and your project is looking at ways of
calculating <span class="math inline">\(\pi\)</span>. Your PI has
recommended using an existing piece of software he saw someone talk
about at a conference recently. A useful feature is that it works in
parallel, and is consequently quite fast! You try running the program on
your laptop, and it takes about 4 seconds for each calculation of <span class="math inline">\(\pi\)</span>. This is a little slow, so you try
running it on Milton</p>
<div id="running-the-program" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="running-the-program" class="callout-inner">
<h3 class="callout-title">Running the Program<a class="anchor" aria-label="anchor" href="#running-the-program"></a>
</h3>
<div class="callout-content">
<p>In the example-programs.zip file, is the <code>pi-cpu</code>
executable. This is the program your supervisor has recommended.
<strong>Try running it with <code>srun</code> on Milton!</strong> Does
it perform each calculation of <span class="math inline">\(\pi\)</span>
in less time than 4s?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> pi-cpu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11087600 queued and waiting for resources
srun: job 11087600 has been allocated resources
   3.1415074000000001        5.9151714229956269     
   3.1413628999999998        5.9161072040442377     
   3.1414266999999998        5.9398186031030491
...</code></pre>
</div>
<p>Each calculation of <span class="math inline">\(\pi\)</span> takes
about 6 seconds - <em>slower</em> than your laptop! This is something to
remember about HPC: The main reason why HPC is “faster” is because it
has <em>many</em> CPU cores, but the cores working individually are
probably slower than your PC’s CPU cores. HPC’s usefulness comes from
hundreds or thousands of CPU cores working in parallel!</p>
</div>
</div>
</div>
</div>
<p>You tell your supervisor that HPC isn’t helping! But they assure you
that it should be really fast - the presenter at the conference
demonstrated times way less than 6 seconds!</p>
<p>Your job now is to figure out why <code>pi-cpu</code> isn’t
performing fast for you.</p>
</section><section id="check-1-is-it-really-working-in-parallel"><h2 class="section-heading">Check 1: Is it really working in parallel?<a class="anchor" aria-label="anchor" href="#check-1-is-it-really-working-in-parallel"></a>
</h2>
<hr class="half-width">
<p>So far, we’ve only <em>heard</em> that the software works by
performing computations in parallel with multiple CPUs. One way we can
verify this is with the <code>htop</code> tool.</p>
<p><code>htop</code> is an interactive “process” viewer that lets you
monitor processes across the entire node. It’s very similar to Task
Manager on Windows or Activity Monitor on Macs, but it works from the
command line!</p>
<div class="section level3">
<h3 id="interpreting-htops-output">Interpreting <code>htop</code>’s output<a class="anchor" aria-label="anchor" href="#interpreting-htops-output"></a>
</h3>
<p>Try running <code>htop</code> on the login node. You should get
something similar to below:</p>
<figure><img src="fig/htop-screenshot.png" alt="" class="figure mx-auto d-block"><figcaption>Screenshot of <code>htop</code> output</figcaption></figure><p><code>htop</code> gives a lot of information, so here is a quick
explainer on what is being shown.</p>
<p>At the top of the <code>htop</code> output, you’ll see multiple bars
and each bar tells you the activity level of a single CPU core. If a bar
is at 100%, then that means that that CPU core is completely busy.</p>
<figure><img src="fig/htop-screenshot-cpubars.png" alt="" class="figure mx-auto d-block"><figcaption>CPU utilization bars from <code>htop</code></figcaption></figure><p>Below the bar, on the left side, is another bar which tells you how
much of the node’s memory is occupied. Next to the bar is information
about how much load the node is under.</p>
<figure><img src="fig/htop-screenshot-memload.png" alt="" class="figure mx-auto d-block"><figcaption>Memory utilization bars and load from
<code>htop</code></figcaption></figure><p>Everything below that is most important to monitoring your jobs. That
table is a dynamic list of “processes” running on the node. And each
column tells you a bit of different information about the process.</p>
<figure><img src="fig/htop-screenshot-procs.png" alt="" class="figure mx-auto d-block"><figcaption>Process list and fields from <code>htop</code></figcaption></figure><ol style="list-style-type: decimal">
<li>
<code>RES</code> tells you the “resident” memory of the process,
i.e., the memory (in bytes) being used by the process.</li>
<li>
<code>CPU%</code> is the percentage of a CPU core the process is
using.</li>
<li>
<code>Command</code> is telling you the command the process is
running. This can be used to help you figure out which processes are
related to your job.</li>
</ol>
<p>By default, <code>htop</code> will show you <em>everyone’s</em>
processes, which is not relevant to us. To get only your processes, quit
<code>htop</code> by pressing <code>q</code>, and run it again with</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">htop</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<p>You should see a list of processes that belong to you only!</p>
</div>
<div class="section level3">
<h3 id="monitoring-pi-cpu-with-htop">Monitoring <code>pi-cpu</code> with <code>htop</code>
<a class="anchor" aria-label="anchor" href="#monitoring-pi-cpu-with-htop"></a>
</h3>
<p>This time, we’re going to submit the <code>pi-cpu</code> command as a
job with <code>sbatch</code>. We can do so by</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--wrap</span><span class="op">=</span><span class="st">"srun ./pi-cpu"</span></span></code></pre>
</div>

<div id="sbatch---wrap" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="sbatch---wrap" class="callout-inner">
<h3 class="callout-title">
<code>sbatch --wrap</code><a class="anchor" aria-label="anchor" href="#sbatch---wrap"></a>
</h3>
<div class="callout-content">
<p>the <code>--wrap</code> option lets us pass a singular command to
<code>sbatch</code> without having to write an entire script! This is
useful for debugging and when you run <code>sbatch</code> inside
scripts.</p>
</div>
</div>
</div>
<p>Once you’ve confirmed the job has started with <code>squeue</code>,
and determined which node it’s running on, <code>ssh</code> to that node
and run <code>htop -u $USER</code>.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--wrap</span><span class="op">=</span>./pi-cpu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 11088927</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
  11088927   regular     wrap   yang.e  R       0:12      1 sml-n15</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> sml-n15</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>yang.e@sml-n15s password: # enter your password
Last login: Fri Apr 14 14:40:38 2023 from slurm-login.hpc.wehi.edu.au</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">htop</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<figure><img src="fig/htop-picpu-1.png" alt="" class="figure mx-auto d-block"><figcaption>processes associated with <code>pi-cpu</code></figcaption></figure><p>From the <code>Command</code> column, you can find the relevant data
for your job.</p>
<p>Hint: You can click on <code>CPU%</code> to sort processes by their
CPU usage.</p>

<p>If we look at the <code>CPU%</code> column, we can see that the
<code>pi-cpu</code> process is using 100%! That might sound good, but
the percentage is the percentage of a CPU <em>core</em> being used,
i.e., 100% means that 100% of a single CPU core is being used, or 200%
means 100% of two CPU core are being used. So, the <code>pi-cpu</code>
process is only using 1 CPU core i.e., not parallel! This is not what
your PI promised!</p>
<p>But maybe it’s because we didn’t request more CPUs? We didn’t ask for
any specific number of CPUs in our command after all. Let’s try request
4 CPUs instead. But first, let’s cancel the already running job.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scancel</span> 11088927</span></code></pre>
</div>
<p>And then we can try again, but with more CPUs:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> <span class="at">--cpus-per-task</span><span class="op">=</span>4 <span class="at">--wrap</span><span class="op">=</span><span class="st">"srun ./pi-cpu"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 11089020</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
11089020   regular     wrap   yang.e  R       0:12      1 sml-n15</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> sml-n15</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>yang.e@sml-n15s password: # enter your password
Last login: Fri Apr 14 14:40:38 2023 from slurm-login.hpc.wehi.edu.au</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">htop</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<figure><img src="fig/htop-picpu-2.png" alt="" class="figure mx-auto d-block"><figcaption>processes associated with <code>pi-cpu</code> after
requesting more CPUs from Slurm</figcaption></figure><p>Unfortunately, requesting more CPUs from Slurm didn’t help your job
work in parallel.</p>
<p>Now, this job runs forever, so we should cancel it and move on.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scancel</span> 11089020</span></code></pre>
</div>
<div id="job-summary-with-seff" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="job-summary-with-seff" class="callout-inner">
<h3 class="callout-title">Job summary with <code>seff</code><a class="anchor" aria-label="anchor" href="#job-summary-with-seff"></a>
</h3>
<div class="callout-content">
<p>Now that the job is over, try verfying the efficiency of the job with
<code>seff</code>. What is the CPU Efficiency (%) that the
<code>pi-cpu</code> program achieved?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">seff</span> 11089020</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 11089020
Cluster: milton
User/Group: yang.e/allstaff
State: CANCELLED (exit code 0)
Nodes: 1
Cores per node: 4
CPU Utilized: 00:02:11
CPU Efficiency: 25.00% of 00:08:44 core-walltime
Job Wall-clock time: 00:02:11
Memory Utilized: 4.44 MB
Memory Efficiency: 11.10% of 40.00 MB</code></pre>
</div>
<p>In this scenario, you’re interested in the
<code>CPU Efficiency</code> field, which gives a rough indication of the
total CPU cores requested being used. This is different from
<code>htop</code>, where the percentage represents the utilization of a
single CPU core.</p>
<p>But as well as CPUs, jobs need to select an amount of memory to
request. <code>seff</code> can help tune this value with the
<code>Memory Utilized</code> field, which will tell you the maximum
memory used of your job. The <code>Memoy Efficiency</code> percentage is
also useful to help you choose an appropriate memory to request.</p>
<p><code>pi-cpu</code> turns out to be very lightweight, so doesn’t use
much memory at all! When we run it inside a Slurm job without any
options, it comfortably fits within the default memory (for Milton, this
is 10MB).</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="looking-through-help-and-documentation"><h2 class="section-heading">Looking through help and documentation<a class="anchor" aria-label="anchor" href="#looking-through-help-and-documentation"></a>
</h2>
<hr class="half-width">
<div id="discussion4" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#discussion4"></a>
</h3>
<div class="callout-content">
<p>Try looking through <code>pi-cpu</code>’s <a href="https://dummy.com" class="external-link">documentation</a>, or running
<code>pi-cpu</code> with the <code>--help</code> option. Do you find any
clues? See if you can run the <code>pi-cpu</code> in parallel with 4
cores on Slurm!</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Both the documentation and <code>--help</code> output would’ve shown
that the <code>-p &lt;N&gt;</code> option is needed to execute the code
with <code>N</code> number of cores.</p>
<p>So, to execute <code>pi-cpu</code> with 4 cores on Slurm, we can
issue the command</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--cpus-per-task</span><span class="op">=</span>4 pi-cpu <span class="at">-p</span> 4 </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11250525 queued and waiting for resources
srun: job 11250525 has been allocated resources
   3.1414699000000001        2.2529371569398791     
   3.1413426666666666        2.2512652359437197     
   3.1418013333333334        2.2517284939531237
...</code></pre>
</div>
<p>which will send the output straight to the terminal. You will notice
that the reported times to calculate <code>pi-cpu</code> has more than
halved! We can confirm the utilization of the 4 CPUs we requested with
<code>seff</code>:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">seff</span> 11250525</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Job ID: 11250525
Cluster: milton
User/Group: yang.e/allstaff
State: CANCELLED (exit code 0)
Nodes: 2
Cores per node: 2
CPU Utilized: 00:02:47
CPU Efficiency: 97.09% of 00:02:52 core-walltime
Job Wall-clock time: 00:00:43
Memory Utilized: 9.56 MB (estimated maximum)
Memory Efficiency: 23.91% of 40.00 MB (10.00 MB/core)</code></pre>
</div>
<p>The CPU Efficiency is now pretty close to 100%!</p>
<p>Many programs behave like this: they will have parallel capability
built in, but will need to be switched on perhaps with a flag/option
like with <code>pi-cpu</code>. Sometimes it can also be switched on via
an environment variable.</p>
<p>Parallel programs are generally designed to run in this way so that
the parallel program doesn’t unintentionally use up all the resources on
the machine you’re running on.</p>
</div>
</div>
</div>
</div>

<div id="using-more-cpu-cores" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="using-more-cpu-cores" class="callout-inner">
<h3 class="callout-title">Using more CPU cores<a class="anchor" aria-label="anchor" href="#using-more-cpu-cores"></a>
</h3>
<div class="callout-content">
<p>You’re really determined to get the run-time down on this calculation
of <span class="math inline">\(\pi\)</span>! So, try request different
number of CPUs and see what happens with the time it takes to calculate
<span class="math inline">\(\pi\)</span>!</p>
<p>Hint: try 4, 8, and then 16 CPUs. Hint 2: You may wish to run with
<code>--constraint=Icelake</code> to ensure results are consistent!</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--cpus-per-task</span><span class="op">=</span>4 <span class="at">--constraint</span><span class="op">=</span>Icelake pi-cpu <span class="at">-p</span> 4</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11250526 queued and waiting for resources
srun: job 11250526 has been allocated resources
   3.1414699000000001        2.0350698649417609     
   3.1413426666666666        2.0345501780975610     
   3.1418013333333334        2.0344599529635161
...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--cpus-per-task</span><span class="op">=</span>8 <span class="at">--constraint</span><span class="op">=</span>Icelake pi-cpu <span class="at">-p</span> 8</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11250527 queued and waiting for resources
srun: job 11250527 has been allocated resources
   3.1416017333333333        1.0177347098942846     
   3.1413272666666665        1.0174216588493437     
   3.1412556666666664        1.0173165560699999   
...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--cpus-per-task</span><span class="op">=</span>16 <span class="at">--constraint</span><span class="op">=</span>Icelake pi-cpu <span class="at">-p</span> 16</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11250528 queued and waiting for resources
srun: job 11250528 has been allocated resources
   3.1416185666666667       0.50940252700820565     
   3.1413593000000000       0.58702801703475416     
   3.1415241333333332       0.51113899215124547 
...</code></pre>
</div>
<p>If you’re running on Milton, you should see that 4 CPUs brings down
the time to 2 seconds, down from the original 6 seconds. Running with 8
CPUs brings the time down to approx. 1 second (approx 2 times speedup,
relative to 4 cores), and bringing it up to 16 speeds things up almost
twice again!</p>
<p>However, this isn’t always true of all programs. Often, adding twice
the number of cores doesn’t add twice the speed.</p>
<p>In many cases, the program’s documentation will offer some
suggestions on how to choose the right number of cores. You might even
find some advice from others e.g., blog posts or in forums. But if this
isn’t the case, you may need to perform some tests yourself!</p>
<p>For example, I run a program with two cores and I discover it’s 1.8
times faster than one core. I then run the same program but with 4 cores
and find that it’s only 2.5 times as fast compared to one core. We could
say that with two cores, the program has a “scaling efficiency” of 1.8/2
= 90% efficient. But, the four core case is 2.5/4 = 62.5% efficient.
This would tell us that running with two cores is <em>more
efficient</em>, and running with four cores is <em>less efficient</em>,
but <em>faster</em>.</p>
</div>
</div>
</div>
</div>
<div id="hyperthreading" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="hyperthreading" class="callout-inner">
<h3 class="callout-title">Hyperthreading<a class="anchor" aria-label="anchor" href="#hyperthreading"></a>
</h3>
<div class="callout-content">
<p>Do a rough calculation of the speedup efficiency of
<code>pi-cpu</code> from one core to two.</p>
<p>i.e.,</p>
<p><code>srun --constraint=Icelake pi-cpu -p 1</code></p>
<p>and then</p>
<p><code>srun --cpus-per-task=2 --constraint=Icelake pi-cpu -p 2</code></p>
<p>What do you get?</p>
<p>What happens if you run the two-core case again, but this time
requesting 4 cores from Slurm, but still using <code>-p 2</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Comparing 1 CPU with 2 CPUs:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--constraint</span><span class="op">=</span>Icelake pi-cpu <span class="at">-p</span> 1</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11783722 queued and waiting for resources
srun: job 11783722 has been allocated resources
   3.1415080000000000        6.0637675179750659     
   3.1413634333333333        6.1081068610073999     
   3.1414273333333331        6.0584602250019088
...
```bash
srun --cpus-per-task=2 --constraint=Icelake pi-cpu -p 2</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11783726 queued and waiting for resources
srun: job 11783726 has been allocated resources
   3.1412753333333332        4.2544698690180667     
   3.1417406666666667        4.2810971069848165     
   3.1413410666666666        4.2824175169807859
...</code></pre>
</div>
<p>This is approximately 6/(4.28*2) = 70%. Unfortunately not as close to
100% as one might hope!</p>
<p>Requesting 4 CPUs from Slurm, but running
<code>pi-cpu -p 2</code>:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--cpus-per-task</span><span class="op">=</span>4 <span class="at">--constraint</span><span class="op">=</span>Icelake pi-cpu <span class="at">-p</span> 2</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11783729 queued and waiting for resources
srun: job 11783729 has been allocated resources
   3.1412753333333332        2.9079635720700026     
   3.1417406666666667        2.9081675559282303     
   3.1413410666666666        2.9077515611425042 
...</code></pre>
</div>
<p>Which is now roughly 2.05 times faster than the one-core case! But
why the difference? In both cases, we requested <code>pi-cpu</code> to
run in parallel with 2 cores right (through the <code>-p 2</code>
flag)?</p>
<p>This is because on Milton, hyperthreading is turned on, which is
often the case for modern CPUs. Milton’s Slurm is configured such that
when you request 1 CPU, you’re actually getting a hyperthread. For every
two hyperthreads, you get one physical CPU core.</p>
<p>So, when you execute <code>srun --cpus-per-task=2 pi-cpu -p 2</code>,
<code>pi-cpu -p 2</code> is actually executed on a single physical core.
But thanks to hyperthreading, you manage to get some speedup almost for
free! When you execute <code>srun --cpus-per-task=4 pi-cpu 2</code>,
<code>pi-cpu</code> is now running on two seperate physical cores, hence
we see a speedup!</p>
<p>This is important to remember because if you forget about how Slurm
CPUs are equivalent to hyperthreads, rather than physical CPU cores,
programs that run in parallel might appear less efficient (like in the
case of <code>pi-cpu</code>!).</p>
<p>NOTE: this configuration is unique to Milton. Most other HPC
facilities equate Slurm CPUs to physical CPU cores, not hypertheads.</p>
</div>
</div>
</div>
</div>
<div id="using-multiple-nodes" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="using-multiple-nodes" class="callout-inner">
<h3 class="callout-title">Using multiple nodes<a class="anchor" aria-label="anchor" href="#using-multiple-nodes"></a>
</h3>
<div class="callout-content">
<p>You may already be aware of the fact that you can request
<em>multiple nodes</em> from Slurm. Maybe we can use multiple nodes to
speed up the calculation of <span class="math inline">\(\pi\)</span>
more! Let’s try and run <code>pi-cpu</code> on 2 nodes, with 2 CPUs per
node, which gives our job a total request of 4 CPUs. Remember to add the
constraint so we can compare the times to the previous tests!</p>
<p>We will submit this job using <code>srun</code>:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--nodes</span><span class="op">=</span>2 <span class="at">--cpus-per-task</span><span class="op">=</span>2 <span class="at">--constraint</span><span class="op">=</span>Icelake pi-cpu <span class="at">-p</span> 4 </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11250605 queued and waiting for resources
srun: job 11250605 has been allocated resources
   3.1414699000000001        4.0148321390151978     
   3.1414699000000001        4.0033812769688666     
   3.1413426666666666        4.0107331259641796     
   3.1413426666666666        4.0241762008517981     
   3.1418013333333334        4.0181175109464675     
   3.1418013333333334        4.0113181709311903
...</code></pre>
</div>
<p>So our job has started, but wait… The run times are <em>slower</em>
than our previous tests with 4 cores! You might also notice that two
lines with identical results are printed together every iteration.</p>
<p>Try and have a look in the <a href="https://dummy.com" class="external-link">documentation</a> again and see why that might
be!</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>in the <a href="https://dummy.com#parallel-scheme" class="external-link">parallel
scheme</a> section, you will find that to run the program across nodes,
you will</p>
<ol style="list-style-type: decimal">
<li>need to use the <code>pi-cpu-mpi</code> program</li>
<li>use <code>srun</code> or <code>mpiexec</code> to execute the
program</li>
<li>ensure the value passed to the <code>-p</code> flag is the number of
CPUs per node.</li>
</ol>
<p>We’ve been using <code>srun</code> so far, so we only need to change
the program. We also need to change the number after
<code>-p</code>:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> <span class="at">--nodes</span><span class="op">=</span>2 <span class="at">--cpus-per-task</span><span class="op">=</span>2 <span class="at">--constraint</span><span class="op">=</span>Icelake pi-cpu-mpi <span class="at">-p</span> 2 </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>srun: job 11250610 queued and waiting for resources
srun: job 11250610 has been allocated resources
   3.1414906666666669        2.0491894630249590     
   3.1410600000000000        1.9775978401303291     
   3.1420745333333335        2.0391590909566730 
...</code></pre>
</div>
<p>And we can see that the program is now calculating <span class="math inline">\(\pi\)</span> in approximately the same time as the
single-node 4-core example before.</p>
<p>This is because <em>programs are generally unable to work across
nodes by default</em>. They typically require some other framework, with
special instructions on how to run the software. This will often be
explained in the documentation.</p>
<p>Message Passing Interface (MPI) is common in scientific computing -
particularly when it comes to simulation like for Molecular Dynamics and
<em>distributed</em> machine learning (e.g., PyTorch), but other
distributed computing frameworks exist, like Spark + Hadoop.</p>
</div>
</div>
</div>
</div>

<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Requesting more resources from Slurm doesn’t mean your job knows how
to use them!
<ul>
<li>Many programs don’t work in parallel by default - either that
functionality doesn’t exist, or needs to be turned on!</li>
<li>Parallelism across nodes is differently parallelism within nodes.
You usually need to run them a little differently than a normal
program</li>
</ul>
</li>
<li>The <code>htop</code> system tool is a great way to get live
information about how effective your job is</li>
<li>
<code>seff</code> and <code>sacct</code> can be used to get summary
stats about jobs</li>
<li>More CPUs doesn’t always mean an equivalent speedup!</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-04-jobarrays"><p>Content from <a href="04-jobarrays.html">Job Arrays</a></p>
<hr>
<p> Last updated on 2023-05-19 | 
        
        <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/edit/main/episodes/04-jobarrays.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I run a lot of similar jobs?</li>
<li>How can I use job arrays in conjunction with a CSV file?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the job array syntax</li>
<li>Understand how to make use of array indices</li>
<li>Know how to use <code>sed</code> and <code>read</code> to parse</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="processing-samples"><h2 class="section-heading">Processing Samples<a class="anchor" aria-label="anchor" href="#processing-samples"></a>
</h2>
<hr class="half-width">
<p>Now that you feel pretty comfortable with the <code>pi-cpu</code>
program, your supervisor wants you to investigate how the error value of
the tool changes with the number of iterations. This is controlled with
the <code>-n</code> flag.</p>
<p>He’s noted that the tool uses 123,456,789 iterations (approx. 1.2E8),
but he would like to know what the accuracy is like for lower number of
iterations. He would like you to see how the error value behaves for
1E2, 1E3, 1E4, …, up to 1E8 iterations.</p>
<p>You know that running 7 tests manually is not a big deal, but you
decide that you might want to make this easier to use in case the number
of tests increase in the future.</p>
<p>You’ve heard about Slurm job arrays which is good at breaking up
these “parameter scans”, so you decide to give them a go.</p>
<div class="section level3">
<h3 id="job-array-syntax">Job Array Syntax<a class="anchor" aria-label="anchor" href="#job-array-syntax"></a>
</h3>
<p>A Slurm script is turned into a job array with the
<code>--array=&lt;range&gt;</code> sbatch option. On Milton,
<code>&lt;range&gt;</code> can be any integer from 0 up to 1000. To
specify a sequential range of values, you can use the
<code>min-max</code> syntax, where <code>min</code> and <code>max</code>
are the minimum and maximum values of the range.</p>
<p>For example, your Slurm script may look like</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=myjob</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array=1-3</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"hello world"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sleep</span> 3600</span></code></pre>
</div>
<p>This script will execute 10 jobs which request the default CPUs and
memory. The job will print “hello world” to the job’s output file, and
then wait for an hour. When you submit this job, and your job waits in
the queue, this array job will look similar to:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> myjob.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 11784178</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
11784178_[1-3]   regular    myjob   yang.e PD       0:00      1 (None)</code></pre>
</div>
<p>where the <code>[1-3]</code> correspond to the indices passed to
<code>--array</code>. Once they start running, the output from
<code>squeue</code> will look similar to:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">squeue</span> <span class="at">-u</span> <span class="va">$USER</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
 11784178_1   regular    myjob   yang.e  R       0:00      1 sml-n02
 11784178_2   regular    myjob   yang.e  R       0:00      1 sml-n02
 11784178_3   regular    myjob   yang.e  R       0:00      1 sml-n02</code></pre>
</div>
<p>Each job is referred to as a “task” of a single job, each associated
with their own index. In the above example, each array task will have a
task ID of 1-10.</p>
<p>The <code>--array</code> option can also accept lists of integers and
ranges, seperated by commas. For example, <code>--array=1-3,7</code> is
accepetable too! This is useful for testing or rerunning only specific
indices.</p>
<p>Each array task will have its own output file. The default naming is
<code>slurm-&lt;jobID&gt;-&lt;taskID&gt;.out</code>. For example, the
above job submission produced:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> slurm-11784178<span class="pp">*</span>.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>slurm-11784178_1.out  slurm-11784178_2.out  slurm-11784178_3.out</code></pre>
</div>
<div id="cancelling-array-jobs" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="cancelling-array-jobs" class="callout-inner">
<h3 class="callout-title">Cancelling array jobs<a class="anchor" aria-label="anchor" href="#cancelling-array-jobs"></a>
</h3>
<div class="callout-content">
<p>When cancelling jobs, you can reference individual array tasks, a
range, or a list similar to specifying the jobs to run. For example,</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scancel</span> 1174178_[1-3,7]</span></code></pre>
</div>
<p>will cancel only array tasks 1, 2, and 3. If you want to cancel all
the job tasks at once, you can pass only the job ID.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scancel</span> 1174178</span></code></pre>
</div>
<p>This will cancel any unfinished or pending array tasks in the
queue.</p>
<p>Note that this only works for <code>scancel</code>! No other Slurm
command will accept this format.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="environment-variables-in-slurm-jobs">Environment Variables in Slurm Jobs<a class="anchor" aria-label="anchor" href="#environment-variables-in-slurm-jobs"></a>
</h3>
<p>Before you learn more about making use of job arrays, it’s important
to know about Slurm job environment variables!</p>
<p>Every time Slurm runs a job for you, Slurm makes a number of
environment variables available to you. These environment variables
contain information about the job, like the job ID, the job name, or the
job’s resources.</p>
<p>A full list of the available environment variables in a job can be
found with <code>man sbatch</code> and scrolling down to
<code>OUTPUT ENVIRONMENT VARIABLES</code>. You can jump to this section
by typing <code>/output environment variables</code> after you’ve opened
the manual page.</p>
<div id="discussion2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#discussion2"></a>
</h3>
<div class="callout-content">
<p>Try crafting a Slurm script that requests 4 CPUs and 4GB of memory
that says hello, and then prints the node it’s running on, the number of
CPUs requested, and then the memory requested. An example output would
be:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Hello. I am running on sml-n01
These are the resources I requested:
CPUs: 4
Memory: 4096MB</code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The Slurm environment variables needed here are
<code>SLURM_CPUS_PER_TASK</code>, <code>SLURM_JOB_NODELIST</code>, and
<code>SLURM_MEM_PER_NODE</code>.</p>
<p>To produce the output in the challenge, your script needs to look
similar to:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=4G</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Hello. I am running on </span><span class="va">${SLURM_JOB_NODELIST}</span><span class="st">"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"These are the resources I requested:"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"CPUs: </span><span class="va">${SLURM_CPUS_PER_TASK}</span><span class="st">"</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Memory: </span><span class="va">${SLURM_MEM_PER_NODE}</span><span class="st">MB"</span></span></code></pre>
</div>
<p>These parameters can be useful when you would like to automatically
pass the Slurm resource request to a command in your script. For
example, I can make <code>pi-cpu</code> use however many CPUs I’ve
requested automatically by using the `SLURM_CPUS_PER_TASK environment
variable inside a job script:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> pi-cpu <span class="at">-p</span> <span class="va">${SLURM_CPUS_PER_TASK}</span></span></code></pre>
</div>
<p>But be careful: some Slurm environment variables only have a value if
you’ve set it as a flag. For example, in the above example script,
<code>SLURM_CPUS_PER_TASK</code> has a value because we supplied
<code>--cpus-per-task</code>. But if you didn’t set
<code>--cpus-per-task</code>, the corresponding environment variable
would be empty!</p>
</div>
</div>
</div>
</div>

</div>
<div class="section level3">
<h3 id="the-slurm_array_task_id-environment-variable">The <code>SLURM_ARRAY_TASK_ID</code> Environment Variable<a class="anchor" aria-label="anchor" href="#the-slurm_array_task_id-environment-variable"></a>
</h3>
<p>Now back to Slurm job arrays!</p>
<p>While skimming through the manual pages, you might’ve noticed that
one of the environment variables listed is
<code>SLURM_ARRAY_TASK_ID</code>. This variable will store the ID of
each task in a job array, which can be used to control what each task
does.</p>
<p>As practice, we can take the Slurm script we wrote at the beginning
and modify it a little:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=myjob</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array=1-3</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"hello world from task </span><span class="va">${SLURM_ARRAY_TASK_ID}</span><span class="st">"</span></span></code></pre>
</div>
<p>This script should now print
<code>hello world from task &lt;N&gt;</code> where <code>N</code> is
1-3.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> myjob-array.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 11784442</code></pre>
</div>
<p>And once all the job tasks have completed, we should be able to check
the output of each task:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> slurm-11784442-<span class="pp">*</span>.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>hello world from task 1
hello world from task 2
hello world from task 3</code></pre>
</div>
<p>Which is great! Now we just have to figure out how to make use of
these task IDs. Remember: our goal is to execute
<code>pi-cpu -n &lt;iter&gt;</code> where <code>iter</code> is 1E2, 1E3,
…, 1E8.</p>
<p>One might think of using the IDs directly, for example, instead of
<code>#SBATCH --array=1-3</code>, maybe we could try something like</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array=100,1000,10000,100000,1000000,10000000,1000000000</span></span></code></pre>
</div>
<p>But if we add this to our example array script and try to submit it,
we get the error:</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>sbatch: error: Batch job submission failed: Invalid job array specification</code></pre>
</div>
<p>And unfortunately this is because Slurm on Milton has been configured
to accept a <a href="https://slurm.schedmd.com/job_array.html" class="external-link">max job
array index of 1000</a>.</p>
<p>So, we have to figure out another way! A common alternative is to use
a file to store the values we want the job array to scan over. In our
case, we can put together a file with a line for each number of
iterations we want the job array to scan over. Let’s call it
<code>iterations.txt</code>, which contains:</p>
<pre><code><span><span class="fl">100</span></span>
<span><span class="fl">1000</span></span>
<span><span class="fl">10000</span></span>
<span><span class="fl">100000</span></span>
<span><span class="fl">1000000</span></span>
<span><span class="fl">10000000</span></span>
<span><span class="fl">100000000</span></span></code></pre>
<p>But how do we use the job array index to retrieve each of these
lines? We can use the <code>readarray</code> command line utility.</p>
<p><code>readarray</code> is a neat tool that can split text into a Bash
array. Executing the command will start an interactive prompt. To exit,
press Ctrl+D.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># start typing</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">this</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">is</span> an</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">example</span> <span class="co"># pree Ctrl+D to exit</span></span></code></pre>
</div>
<p>Your text gets saved into the <code>MAPFILE</code> array variable
(each index corresponds to a line):</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"line1: </span><span class="va">${MAPFILE</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="va">}</span><span class="st">, line2: </span><span class="va">${MAPFILE</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="va">}</span><span class="st">, line3: </span><span class="va">${MAPFILE</span><span class="op">[</span><span class="dv">2</span><span class="op">]</span><span class="va">}</span><span class="st">"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>line1: this, line2: is an, line3: example</code></pre>
</div>
<p>A couple things to note about referencing elements in bash arrays: *
Array indices start at 0 * <code>${}</code> are on the outside of
<code>array[index]</code>.</p>
<p>Instead of supplying it input manually, we can pass it a file using
redirection:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> <span class="op">&lt;</span> iterations.txt</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${MAPFILE</span><span class="op">[@]</span><span class="va">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>100 1000 10000 100000 1000000 10000000 100000000</code></pre>
</div>
<p>The <code>@</code> symbol means “all the elements in the array”.
Instead of saving the array into <code>MAPFILE</code>, we can pass a
variable name to <code>readarray</code> and it will save the array into
that variable instead e.g.:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> niterations <span class="op">&lt;</span> iterations.txt</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${niterations</span><span class="op">[@]</span><span class="va">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>100 1000 10000 100000 1000000 10000000 100000000</code></pre>
</div>
<p>Can you start to see how we might combine the Slurm array index and
our bash array to pass different iteration values to
<code>pi-cpu</code>?</p>
<div id="tests" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tests" class="callout-inner">
<h3 class="callout-title">Tests<a class="anchor" aria-label="anchor" href="#tests"></a>
</h3>
<div class="callout-content">
<p>It’s generally good practice to <em>test</em> your array job before
you run it for real. This is especially true if you plan to run a large
number of tasks!</p>
</div>
</div>
</div>
<p>Let’s first test that we know how to properly combine the
<code>SLURM_ARRAY_TASK_ID</code> environment variable together with
<code>readarray</code>. Take your script and modify it:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=myjob</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array=0-2</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"hello world from task </span><span class="va">${SLURM_ARRAY_TASK_ID}</span><span class="st">"</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> niterations <span class="op">&lt;</span> iterations.txt</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"I will run </span><span class="va">${niterations</span><span class="op">[</span><span class="va">$SLURM_ARRAY_TASK_ID</span><span class="op">]</span><span class="va">}</span><span class="st">!"</span></span></code></pre>
</div>
<p>Note that we’ve changed the array task range from 1-3 to 0-3 since
the bash array is 0-indexed.</p>
<p>Let’s submit this script to confirm that we’ve used `readarray``
correctly.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> myjob-array.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitted batch job 11784737</code></pre>
</div>
<p>Because we’ve only passed the range <code>0-1</code> to the
<code>--array</code> option, we should expect to only see outputs for
the first 3 rows in <code>iterations.txt</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> slurm-11784737_<span class="pp">*</span>.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>hello world from task 0
I will run 100
!
hello world from task 1
I will run 1000
!
hello world from task 2
I will run 10000
!</code></pre>
</div>
<p>Which demonstrates that we’ve taken the first 3 lines of
<code>iterations.txt</code> correctly! But there’s something wrong… the
exclamation marks on the next line instead of at the end of the number!
This is because <code>readarray</code> keeps newline characters when
parsing the file. To turn off this behavior we need to add the
<code>-t</code> option, so our <code>readarray</code> command
becomes:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> <span class="at">-t</span> niterations <span class="op">&lt;</span> iteration.txt</span></code></pre>
</div>
<p>We can now make use of these values by passing the number of
iterations to the <code>pi-cpu</code> command. We also need to change
the array range to pull all the lines of the <code>iterations.txt</code>
file. Change the array range and add the <code>pi-cpu</code> command to
your script:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array=0-6</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> ./pi-cpu <span class="at">-p</span> <span class="va">${SLURM_CPUS_PER_TASK}</span> <span class="at">-n</span> <span class="va">${niterations</span><span class="op">[</span><span class="va">$SLURM_ARRAY_TASK_ID</span><span class="op">]</span><span class="va">}</span></span></code></pre>
</div>
<p>You will also need to ensure that <code>--cpus-per-task</code> is
provided here, as without that option, <code>SLURM_CPUS_PER_TASK</code>
doesn’t get set either.</p>
<p>We can then submit the script:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sbatch</span> myjob-array.sh</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># wait for the job tasks to finish...</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> slurm-<span class="pp">*</span>.out</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>$ cat slurm-11913780_*.out
hello world from task 0
I will run 100!
Result: 3.1600000000000 Error:  0.0184072589874 Time: 0.0003s
... skipped output

hello world from task 1
I will run 1000!
Result: 3.0480000000000 Error: -0.0935927410126 Time: 0.0004s
... skipped output

hello world from task 2
I will run 10000!
Result: 3.1344000000000 Error: -0.0071927410126 Time: 0.0056s
... skipped output

hello world from task 3
I will run 100000!
Result: 3.1431600000000 Error:  0.0015672589874 Time: 0.0013s
... skipped output

hello world from task 4
I will run 1000000!
Result: 3.1421880000000 Error:  0.0005952589874 Time: 0.0100s
... skipped output

hello world from task 5
I will run 10000000!
Result: 3.1419520000000 Error:  0.0003592589874 Time: 0.0936s
... skipped output

hello world from task 6
I will run 100000000!
Result: 3.1414855200000 Error: -0.0001072210126 Time: 0.9331s
... skipped output</code></pre>
</div>
<p>And now you can see the magnitude of the error, and the speed
decreasing as we increase the number of iterations.</p>
</div>
<div class="section level3">
<h3 id="multi-column-data">Multi-column data<a class="anchor" aria-label="anchor" href="#multi-column-data"></a>
</h3>
<p>So far you’ve only needed one column of data (the number of
iterations) to investigate accuracy with number of iterations. But, in
many cases you might be interested in varying multiple variables with
each array task.</p>
<p>We can do this by adding another column to our data. Create a new
file called iter-cpu.txt with the content:</p>
<pre><code>iters cpus
100 2
100 4
1000 2
1000 4
10000 2
10000 4</code></pre>
<p>The first row is now a header and rows 2-7 contains the data we’ll
use in our job arrays. Here, we’re going to vary the value passed to
<code>-p</code>.</p>
<p>We can still execute <code>readarray</code> on this file:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> filedata <span class="op">&lt;</span> iter-cpu.txt</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${filedata</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="va">}</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>iters cpus</code></pre>
</div>
<p>But the columns don’t get split!</p>
<p>So how do we split the columns? <code>cut</code> is a tool you might
be aware of (for example from an <a href="https://monashdatafluency.github.io/shell-novice/" class="external-link">introductory
course</a>). But, this time, lets split the lines of text using the
<code>read</code> utility.</p>
<p>We can use the “heredoc” operator <code>&lt;&lt;&lt;</code> to pass
text to the <code>read</code> command:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">"hello world"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$REPLY</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>hello world</code></pre>
</div>
<p>By default, <code>read</code> saves what we send it to the variable
<code>REPLY</code>. Note that unlike <code>readarray</code>,
<code>REPLY</code> is not an array. We can choose the variable to save
our input to by giving <code>read</code> a variable name:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="va">myvar</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">"hello world"</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$myvar</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>hello world</code></pre>
</div>
<p><code>read</code> is also useful because if we pass it more variable
names, it will split the words into each of thoses variables. So, if we
add another variable name to our previous <code>read</code> command:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="va">myvar1</span> <span class="va">myvar2</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">"hello world"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"myvar1: </span><span class="va">$myvar1</span><span class="st">, myvar2: </span><span class="va">$myvar2</span><span class="st">"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>myvar1: hello, myvar2: world</code></pre>
</div>
<div id="parsing-the-iter-cpu.txt-file" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="parsing-the-iter-cpu.txt-file" class="callout-inner">
<h3 class="callout-title">parsing the <code>iter-cpu.txt</code>
file<a class="anchor" aria-label="anchor" href="#parsing-the-iter-cpu.txt-file"></a>
</h3>
<div class="callout-content">
<p>We now know how to split lines of a file into an array using
<code>readarray</code> and, as well as splitting strings with spaces
into individual words!</p>
<p>See if you can apply this to our current case: try and get
<strong>the first line</strong> from <code>iter-cpu.txt</code> and save
the first column into <code>niterations</code> and the second column
into <code>ncpus</code> bash variables</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>As shown already we can save <code>iter-cpu.txt</code> into an array
using</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> <span class="at">-t</span> rowdata <span class="op">&lt;</span> iter-cpu.txt</span></code></pre>
</div>
<p>This gives us an array, <code>rowdata</code>, where each element is a
line of text from <code>iter-cpu.txt</code>. To split the first line of
the file into variables <code>niterations</code> and
<code>ncpus</code>:</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="va">niterations</span> <span class="va">ncpus</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">"</span><span class="va">${rowdata</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="va">}</span><span class="st">"</span></span></code></pre>
</div>
<p><code>${rowdata[0]}</code> is referencing the first element of
<code>rowdata</code>, and therefore the first line of text in
<code>iter-cpu.txt</code>. <code>read</code> will take this the row
data, and split the two words into <code>niterations</code> and
<code>ncpus</code> variables.</p>
</div>
</div>
</div>
</div>
<div id="which-array-indices" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="which-array-indices" class="callout-inner">
<h3 class="callout-title">Which array indices?<a class="anchor" aria-label="anchor" href="#which-array-indices"></a>
</h3>
<div class="callout-content">
<p>Our new text file not only has a new column, but we’ve also added
headers.</p>
<p>So, before we make use of <code>readarray</code> in our job array,
should we change the range passed to <code>--array</code> to make sure
our new Slurm array script works?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Yes we do! While we have the same number of rows in
<code>iter-cpu.txt</code>, the first row is headers. If we passed those
headers to <code>pi-cpu</code> instead of integer values, the program
would fail. We need to ensure only array tasks 1-6 are being run
(remember: the 0th index is the first row in the file i.e., the
headers).</p>
<p>Be aware of this when you write your own files and job array
scripts!</p>
</div>
</div>
</div>
</div>
<div id="use-the-second-columns-iter-cpu.txt" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="use-the-second-columns-iter-cpu.txt" class="callout-inner">
<h3 class="callout-title">Use the second columns
<code>iter-cpu.txt</code><a class="anchor" aria-label="anchor" href="#use-the-second-columns-iter-cpu.txt"></a>
</h3>
<div class="callout-content">
<p>Adapt your array job to use what we’ve learnt so far about
<code>readarray</code> and <code>read</code> to adapt your script to
make use of the 2 columns in <code>iter-cpu.txt</code>! The first column
should be passed to <code>-n</code> and the second should be passed to
<code>-p</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>We first need to modify the <code>readarray</code> line to read the
correct file, and to use an appropriately named array variable:</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> <span class="at">-t</span> rowdata <span class="op">&lt;</span> iter-cpu.txt</span></code></pre>
</div>
<p>We then need to split <code>rowdata</code> further into
<code>niterations</code> and <code>ncpus</code>. To do this, we will
adapt what we wrote for “Parsing the <code>iter-cpu.txt</code> file”
challenge. Instead of reading the first “0th” element of
<code>rowdata</code>, we’ll use the <code>SLURM_ARRAY_TASK_ID</code>
environment variable:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="va">niterations</span> <span class="va">ncpus</span> <span class="op">&lt;&lt;&lt;</span> <span class="va">${rowdata</span><span class="op">[</span><span class="va">$SLURM_CPUS_PER_TASK</span><span class="op">]</span><span class="va">}</span></span></code></pre>
</div>
<p>And finally, we can add <code>niterations</code> and
<code>ncpus</code> to our echo and <code>pi-cpu</code> execution
command!</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"I will run </span><span class="va">$niterations</span><span class="st"> iterations and with </span><span class="va">$ncpus</span><span class="st"> CPUs!"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> pi-cpu <span class="at">-p</span> <span class="va">$ncpus</span> <span class="at">-n</span> <span class="va">$niterations</span></span></code></pre>
</div>
<p>Our final script should look something like:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=myjob</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array=1-6</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=4</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"hello world from task </span><span class="va">${SLURM_ARRAY_TASK_ID}</span><span class="st">"</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="ex">readarray</span> <span class="at">-t</span> rowdata <span class="op">&lt;</span> iter-cpu.txt</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="va">niterations</span> <span class="va">ncpus</span> <span class="op">&lt;&lt;&lt;</span> <span class="va">${rowdata</span><span class="op">[</span><span class="va">$SLURM_CPUS_PER_TASK</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"I will run </span><span class="va">$niterations</span><span class="st"> with </span><span class="va">$ncpus</span><span class="st"> CPUs!"</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> pi-cpu <span class="at">-p</span> <span class="va">$ncpus</span> <span class="at">-n</span> <span class="va">$niterations</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>

<div id="different-delimiters-optional" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="different-delimiters-optional" class="callout-inner">
<h3 class="callout-title">Different delimiters (optional)<a class="anchor" aria-label="anchor" href="#different-delimiters-optional"></a>
</h3>
<div class="callout-content">
<p>Here we showed how to split text that is seperated by spaces.
e.g.</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="va">string</span><span class="op">=</span><span class="st">"hello world"</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="va">word1</span> <span class="va">word1</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">"</span><span class="va">$string</span><span class="st">"</span></span></code></pre>
</div>
<p>But different delimiters can be used using the following syntax:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="va">string</span><span class="op">=</span><span class="st">"hello world"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="va">IFS</span><span class="op">=&lt;</span>delimiter<span class="op">&gt;</span> read <span class="ex">word1</span> word2 <span class="op">&lt;&lt;&lt;</span> <span class="st">"</span><span class="va">$string</span><span class="st">"</span></span></code></pre>
</div>
<p><code>IFS</code> is a special environment variable used by bash to
determine how to split strings. By setting it to a different
character(s), you can control how <code>read</code> splits your string.
What should you set <code>IFS</code> to to get the following output from
<code>echo "word1: $word1, word2: $word2"</code>?</p>
<ol style="list-style-type: decimal">
<li><code>word1: hello , word2: orld</code></li>
<li><code>word1: , word2: ello world</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">
  Show me the solution
  </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>
<code>IFS=w</code>:</li>
</ol>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="va">string</span><span class="op">=</span><span class="st">"hello world"</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="va">IFS</span><span class="op">=</span>w <span class="bu">read</span> <span class="va">word1</span> <span class="va">word2</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">"</span><span class="va">$string</span><span class="st">"</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"word1: </span><span class="va">$word1</span><span class="st">, word2: </span><span class="va">$word2</span><span class="st">"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>word1: hello , word2: orld</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li><code>IFS=h</code></li>
</ol>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="va">string</span><span class="op">=</span><span class="st">"hello world"</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="va">IFS</span><span class="op">=</span>h <span class="bu">read</span> <span class="va">word1</span> <span class="va">word2</span> <span class="op">&lt;&lt;&lt;</span> <span class="st">"</span><span class="va">$string</span><span class="st">"</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"word1: </span><span class="va">$word1</span><span class="st">, word2: </span><span class="va">$word2</span><span class="st">"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>word1: , word2: ello world</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Slurm job arrays are a great way to parallelise similar jobs!</li>
<li>The <code>SLURM_ARRAY_TASK_ID</code> environment variable is used to
control individual array tasks’ work</li>
<li>A file with all the parameters can be used to control array task
parameters</li>
<li>
<code>readarray</code> and <code>read</code> are useful tools to
help you parse files. But it can also be done many other ways!</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/" class="external-link">Source</a></p>
				<p><a href="https://github.com/WEHI-ResearchComputing/intermediate-slurm/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:research.computing@wehi.edu.au">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.12.2" class="external-link">sandpaper (0.12.2)</a>,
        <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.5.3)</a>,
      and <a href="https://github.com/carpentries/varnish/tree/0.2.17" class="external-link">varnish (0.2.17)</a>.</p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://WEHI-ResearchComputing.github.io/intermediate-slurm/aio.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "Slurm, HPC",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://WEHI-ResearchComputing.github.io/intermediate-slurm/aio.html",
  "identifier": "https://WEHI-ResearchComputing.github.io/intermediate-slurm/aio.html",
  "dateCreated": "2023-04-13",
  "dateModified": "2023-05-30",
  "datePublished": "2023-05-30"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

